---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "accuknox_kubearmor_host_security_policy Resource - terraform-provider-accuknox"
subcategory: "kubearmor"
description: |-
   This resource will give us the ability to manage the host security policies.
  
---

# accuknox_kubearmor_host_security_policy (Resource)

`accuknox_kubearmor_host_security_policy` will give us the ability to manage the host security policies. Read more about host security policies [here](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification).

## Example Usage

There are two ways in which you can configure the `accuknox_kubearmor_host_security_policy` resource:

1. Using the yaml format policy(recommended way)

Directly use the policy to define it in the yaml format. Since we are applying a policy as an object, updating it would trigger `destroy and then create operation`, therefore new policy will be created. Here, we are creating/managing a policy for host which blocks `/usr/bin/diff` path.

```
resource "accuknox_kubearmor_host_security_policy" "hsp-kubearmor-dev-proc-path-block" {
  policy= <<-EOT
  apiVersion: security.kubearmor.com/v1
  kind: KubeArmorHostPolicy
  metadata:
    name: hsp-kubearmor-dev-proc-path-block
  spec:
    nodeSelector:
      matchLabels:
        kubernetes.io/hostname: kubearmor-dev
    severity: 5
    process:
      matchPaths:
      - path: /usr/bin/diff
    action:
      Block
  EOT
}
```

2. Using schema format:

Use objects such as `process`, `network`, `file`, etc to define rules of the policy. We can also update the policy, except for the name and namespace, updating them would trigger `destroy and then create operation`. Here, we are creating/managing a policy for host which alerts when there is an access to `/etc/passwd` path.

```
resource "accuknox_kubearmor_host_security_policy" "hsp-kubearmor-dev-file-path-audit" {
  name="hsp-kubearmor-dev-file-path-audit"
  severity= 5
  action= "Audit"
  
  node_selector {
    match_labels= {
      "kubernetes.io/hostname": "kubearmor-dev",
    }
  }
  
  file {
    match_paths{
        path= "/etc/passwd"
      }
  }
}
```

### Argument Reference

#### For yaml format:

- `policy` (Required) To provide full policy in yaml format. Read more [here](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification).

#### For schema format:

- `name` (Required) Name of the policy. Use unique policy name.
- `node_selector` (Required) (see [below for nested schema](#Node_Selector)) Similar to other Kubernetes configurations, you can specify (a group of) nodes based on labels.
- `action` (Required) The action could be Audit or Block in general. In order to use the Allow action, you should define `fromSource`; otherwise, all Allow actions will be ignored by default.
- `process` (Optional) (see [below for nested schema](#Process)) You can define specific executables using matchPaths or all executables in specific directories using matchDirectories.
- `file` (Optional) (see more for [below for nested schema](#File)) You can define specific files using matchPaths or all files in specific directories using matchDirectories.
- `network` (Optional) (see [below for nested schema](#Network)) You can define specific protocols among TCP, UDP, and ICMP.
- `capabilities` (Optional) (see [below for nested schema](#Capabilities)) You can define specific capability names to allow or block using matchCapabilities.
- `syscalls` (Optional) (see [below for nested schema](#Syscalls)) In the case of syscalls, there are two types of matches, matchSyscalls and matchPaths. matchPaths can be used to target system calls targeting specific binary path or anything under a specific directory, additionally you can slice based on syscalls generated by a binary or a group of binaries in a directory. You can use matchSyscall as a more general rule to match syscalls from all sources or from specific binaries.
- `severity` (Optional) You can specify the severity of a given policy from 1 to 10. This severity will appear in alerts when policy violations happen.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize security policies.

### Node_Selector

- `match_labels` (Required) key-value pair labels to specify pod(s).

### Process

- `match_directories` (Optional) (see [below for nested schema](#Match_Directories)) You can define all executables in specific directories using matchDirectories.
- `match_paths` (Optional) (see [below for nested schema](#Match_Paths)) You can define specific executables using matchPaths.
- `match_patterns` (Optional) (see [below for nested schema](#Match_Patterns)) Advanced operators may be able to determine particular patterns for files by using regular expressions.
- `action` (Optional) The action could be Allow, Audit, or Block. File would be handled in a blacklist manner or a whitelist manner according to the action.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.

### File

- `match_directories` (Optional) (see [below for nested schema](#Match_Directories)) You can define all files in specific directories using matchDirectories.
- `match_paths` (Optional) (see [below for nested schema](#Match_Paths)) You can define specific file using matchPaths.
- `match_patterns` (Optional) (see [below for nested schema](#Match_Patterns)) Advanced operators may be able to determine particular patterns for files by using regular expressions.
- `action` (Optional) The action could be Allow, Audit, or Block. File would be handled in a blacklist manner or a whitelist manner according to the action.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.

### Network 

- `match_protocols` (Required) (see [below for nested schema](#Match_Protocols))
- `action` (Optional) The action could be Allow, Audit, or Block. File would be handled in a blacklist manner or a whitelist manner according to the action.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.

### Capabilities

- `match_capabilities` (Required) (see [below for nested schema](#Match_Capabilities)) You can define specific capability names to allow or block using matchCapabilities.
- `action` (Optional) The action could be Allow, Audit, or Block. File would be handled in a blacklist manner or a whitelist manner according to the action.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.

### Syscalls

- `match_paths` (Optional) (see [below for nested schema](#Syscall_Match_Path)) MatchPaths can be used to target system calls targeting specific binary path or anything under a specific directory, additionally you can slice based on syscalls generated by a binary or a group of binaries in a directory.
- `match_syscalls` (Optional) (see [below for nested schema](#Match_Syscalls)) You can use matchSyscall as a more general rule to match syscalls from all sources or from specific binaries.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.


### Match_Directories

- `dir` (Required) Absolute directory path.

- `from_source` (Optional) (see [below for nested schema](#From_Source)) If a file/executable specified in fromSource, the file/executable at the path will be allowed/blocked to execute the executables defined with matchPaths or matchDirectories. Refer [docs](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification) for more.
- `owner_only` (Optional) If this is enabled, the owners of the file/executable(s) defined with matchPaths and matchDirectories will be only allowed to execute. Refer [docs](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification) for more.
- `action` (Optional) The action could be Allow, Audit, or Block. Directory/Executables would be handled in a blacklist manner or a whitelist manner according to the action.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `recursive` (Optional) If this is enabled, the coverage will extend to the subdirectories of the directory defined with matchDirectories.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.

> `read_only` is used for only for [below for nested schema](#File) object not for Process. This is the only difference between their schema. 
- `read_only` (Optional) If this is enabled, the read operation will be only allowed, and any other operations (e.g., write) will be blocked.

### Match_Paths

- `path` (Required) Absolute executable path
- `from_source` (Optional) (see [below for nested schema](#From_Source)) If a file/executable specified in fromSource, the file/executable at the path will be allowed/blocked to execute the executables defined with matchPaths or matchDirectories. Refer [docs](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification) for  more.
- `owner_only` (Optional) If this is enabled, the owners of the file/executable(s) defined with matchPaths and matchDirectories will be only allowed to execute. Refer [docs](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification) for more.
- `action` (Optional) The action could be Allow, Audit, or Block. Path/Executables would be handled in a blacklist manner or a whitelist manner according to the action.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.

> `read_only` is used for only [below for nested schema](#File) object not for Process. This is the only difference between their schema. 
- `read_only` (Optional) If this is enabled, the read operation will be only allowed, and any other operations (e.g., write) will be blocked.

### Match_Patterns

- `pattern` (Required) Regex pattern. Refer [docs](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification) for  more.
- `owner_only` (Optional) If this is enabled, the owners of the file/executable(s) defined with matchPaths and matchDirectories will be only allowed to execute. Refer [docs](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification) for more.
- `action` (Optional) The action could be Allow, Audit, or Block. Path/Executables would be handled in a blacklist manner or a whitelist manner according to the action.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.

> `read_only` is used for only [below for nested schema](#File) object not for Process. This is the only difference between their schema. 
- `read_only` (Optional) If this is enabled, the read operation will be only allowed, and any other operations (e.g., write) will be blocked.

### Match_Capabilities

- `capabilities` (Required) Specific capability names.
- `from_source` (Optional) (see [below for nested schema](#From_Source)) If a file/executable specified in fromSource, the file/executable at the path will be allowed/blocked to execute the executables defined with matchPaths or matchDirectories. Refer [docs](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification) for  more.
- `action` (Optional) The action could be Allow, Audit, or Block. File would be handled in a blacklist manner or a whitelist manner according to the action.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.

### Match_Protocols

- `protocol` (Required) Specific protocols among TCP, UDP, and ICMP.
- `from_source` (Optional) (see [below for nested schema](#From_Source)) If a file/executable specified in fromSource, the file/executable at the path will be allowed/blocked to execute the executables defined with matchPaths or matchDirectories. Refer [docs](https://docs.kubearmor.io/kubearmor/documentation/host_security_policy_specification) for  more.
- `action` (Optional) The action could be Allow, Audit, or Block. File would be handled in a blacklist manner or a whitelist manner according to the action.
- `severity` (Optional) You can specify the severity from 1 to 10. This severity will appear in alerts when policy violations happen.
- `tags` (Optional) You can define multiple tags (e.g., WARNING, SENSITIVE, MITRE, STIG, etc.) to categorize file.
- `message` (Optional) You can add an alert message, and then the message will be presented in alert logs.

### Match_Syscalls

- `syscall` (Required) List syscalls
- `from_source` (Optional) (see [below for nested schema](#Syscall_From_Source))

### Syscall_Match_Path

- `path` (Required) absolute directory path or absolute exectuable path
- `from_source` (Optional) (see [below for nested schema](#Syscall_From_Source))
- `recursive` (Optional) If this is enabled, the coverage will extend to the subdirectories of the directory defined with matchDirectories.
- `syscall` (Optional) List syscalls.

### From_Source

- `path` (Required) The file/executable at the path will be allowed/blocked to execute the file/executables.

### Syscall_From_Source

- `dir` (Optional) absolute directory path
- `path` (Optional) absolute exectuable path
- `recursive` (Optional) If this is enabled, the coverage will extend to the subdirectories of the directory defined with matchDirectories.
